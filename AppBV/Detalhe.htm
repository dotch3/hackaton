<!doctype html>
<html lang="pt-br">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<title>APP Boa Vizinhança</title>

	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
		integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

	<!-- Normalize.css -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
		crossorigin="anonymous">

	<!-- Scrollbar Custom CSS -->
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">

	<!-- Font Awesome JS -->
	<script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
		integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
		crossorigin="anonymous"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
		integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
		crossorigin="anonymous"></script>

	<link rel="stylesheet" href="css/style01.css">
	<link rel="stylesheet" href="css/styleDetalhe.css">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

	<div class="wrapper">
		<!-- Sidebar  -->
		<nav id="sidebar">
			<div id="dismiss">
				<i class="fas fa-times-circle"></i>
			</div>

			<div class="sidebar-header">
				<h5>Menu</h5>
				<br />
				<img src="images/profile.png" width="94" height="94" alt="Perfil" />
			</div>
			<ul class="list-unstyled components">
				<li>
					<a href="MinhasPub.htm">Minhas Publicações</a>
				</li>
				<li>
					<a href="#">Publicações Salvas</a>
				</li>
				<li>
					<a href="#">Configurações</a>
				</li>
				<li>
					<a href="#">Central de Ajuda</a>
				</li>
			</ul>
			<ul class="list-unstyled">
				<li>
					<a href="Default.htm">Sair</a>
				</li>
			</ul>
		</nav>

		<!-- Page Content  -->
		<div id="content" class="container-fluid">

			<nav class="navbar navbar-expand-lg navbar-light bg-light navbar-fixed-top">
				<div class="container-fluid">
					<div class="row">
						<div class="col-xs-6">
							<button id="sidebarCollapse" class="btn btn-dark d-inline-block d-lg-none ml-auto"
								type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
								aria-controls="navbarSupportedContent" aria-expanded="false"
								aria-label="Toggle navigation">
								<i class="fas fa-align-justify" style="font-size: 20px;"></i>
							</button>
							Boa Vizinhança
						</div>
						<div class="col-xs-4">
							<!-- Search form -->
							<form class="form-inline d-flex justify-content-center md-form form-sm">
								<input class="form-control form-control-sm mr-3 w-75" type="text" id="txtPesquisar"
									placeholder="Pesquisar" style="margin-top: 5px; width: 120px; height: 25px"
									aria-label="Search" />
							</form>
						</div>
						<div class="col-xs-2">
							<button class="btn btn-dark d-inline-block d-lg-none ml-auto" type="button"
								data-toggle="collapse" data-target="#navbarSupportedContent"
								aria-controls="navbarSupportedContent" aria-expanded="false"
								aria-label="Toggle navigation">
								<i class="fas fa-search" style="font-size: 20px;"></i>
							</button>
						</div>
					</div>
				</div>
			</nav>
			<div class="container-fluid">
				<p>&nbsp;</p>
				<div class="row">
					<div class="col-xs-1"></div>
					<div class="col-xs-10">
						<h5>Você precisa de algum dos itens abaixo?</h5>
					</div>
					<div class="col-xs-3"></div>
				</div>
				<div class="row">
					<div class="col-xs-3"><a href="Itens.htm"><img src="images/menu_top01.png" width="75" height="51"
								alt="Você precisa de algum dos itens abaixo?" /></a></div>
					<div class="col-xs-3"><img src="images/menu_top02.png" width="75" height="51"
							alt="Você pode emprestar algum dos itens abaixo?" /></div>
					<div class="col-xs-3"><img src="images/menu_top03.png" width="75" height="51"
							alt="Você precisa de algum dos serviços abaixo?" /></div>
					<div class="col-xs-3"><img src="images/menu_top04.png" width="75" height="51"
							alt="Você pode oferecer algum dos serviços abaixo?" /></div>
				</div>
			</div>

			<p>&nbsp;</p>
			<div id="divDetalheItem">
				<div id="divItem" class="container-fluid">
					<div id="publicacoes" class="row">
						<div class="col-xs-1">
							<div class="detalhe-imagem">
								<span class="pub_imagem"><i class="fas fa-image" style="font-size: 50px"></i></span><br>
								<span class="pub_data detalhe-data "><i class="fas fa-image"
										style="font-size: 50px"></i></span><br>
							</div>

						</div>
						<div class="col-xs-1"></div>
						<div class="col-xs-10">
							<span class="pub_titulo">[titulo]</span><br />
							<span class="pub_descricao">[descricao]</span><br />
							<p><b>*</b><span class="pub_observacao"
									style="text-decoration: underline;">[observacao]</span></p><span
								class="pub_tags detalhe-tags badge badge-pill badge-info">
								[tags]</span><br />

							<a href="#" class="pub_urlUserId">
								<p class="detalhe-user"><i class="fas fa-user"></i><b>&nbsp; Proprietario</b></p>
							</a>
						</div>


					</div>
					<hr>
				</div>
			</div>
			<form action="JavaScript:sendPropostaJson()" class="container">
				<div class="row">
					<div class="col-xs-1"></div>
					<div class="col-xs-10">
						<div class="form-group">
							<label for="pub_valor" class="lblCampo">PAGO PELO EMPRÉSTIMO</label>
							<div class="input-group">
								<span class="input-group-addon"><i class="fas fa-dollar-sign"
										style="font-size: 15px;"></i></span>
								<input type="text" class="form-control pub_valor" id="valor" name="valor" value="">
							</div>
						</div>
					</div>
					<div class="col-xs-1"></div>

				</div>

				<div class="row container-fluid">
					<!-- <p>&nbsp;</p> -->
					<div class="row container-fluid" style=" display: none;">
						<input type="text" name="idUser" id="idUser" value="">
						<input type="text" name="idItem" id="idItem" value="">
						<!-- style=" display: none;" -->
					</div>
					</br>
					<div class="row">
						<div class="col-xs-1"></div>
						<div class="col-xs-5 form-group">
							<label for="dataSugestaoEmprestimo">INICIO EMPRESTIMO: </label>
							<br>
							<input class="bv" id="dataInicio" name="dataInicio" type="date" required />
						</div>

						<div class="col-xs-5 form-group ">
							<label for="dataSugestaoDevolucao">FIM EMPRESTIMO: </label>
							<br>
							<input class="bv" id="dataFim" name="dataFim" type="date" required />
						</div>
						<div class="col-xs-1"></div>
					</div>
				</div>

				<br />
				<p>&nbsp;</p>

				<div class="row " style="text-align: center;" ;>
					<!-- <div class="col text-center">
						<a href="#" type="submit" class="btn btn-warning btn-padrao">FAZER PROPOSTA</a>
					</div> -->
					<button type="submit" class="btn btn-outline-secondary btn-padrao" style="background: #ec971f !important;  color: white !important;  
					                                        font-weight: 400 !important; border-color: #fea556;
					                                        margin-bottom: 1rem; font-size: 1.25rem;width: 180px;
					                                        border-radius: 20px;">FAZER PROPOSTA</button>
				</div>
			</form>
			<!-- End FORM -->
			<br />
			<div class="row " style="text-align: center;">
				<div class="col text-center">
					<a href="Itens.htm" class="btn btn-warning btn-padrao">VOLTAR PARA LISTA</a>
				</div>
			</div>

			<div class="navbar navbar-default navbar-fixed-bottom">
				<div class="container">
					<p class="navbar-text pull-left">

					<div class="container-fluid">
						<div class="row">
							<div class="col-xs-1"></div>
							<div class="col-xs-10"><img src="images/menu_bottom.png" width="268" height="50" />
							</div>
							<div class="col-xs-3"></div>
						</div>
					</div>

					</p>
				</div>
			</div>

		</div>

		<div class="overlay"></div>

		<!-- Small modal -->
		<div class="modal fade modal-carregando tabindex=" -1" role="dialog" aria-labelledby="mySmallModalLabel"
			aria-hidden="true">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					<div class="row">
						<div class="col-xs-4">
							<div class="loader"></div>
						</div>
						<div class="col-xs-8">
							<br />Por favor, aguarde...
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade modal-pesquisar-semregistros" tabindex="-1" role="dialog"
			aria-labelledby="mySmallModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					Nenhum registro foi encontrado.
				</div>
			</div>
		</div>

		<div class="modal fade modal-proposta-enviada" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
			aria-hidden="true">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					Proposta enviada. Aguardando avaliação.
				</div>
			</div>
		</div>
		<div class="modal fade modal-proposta-invalido" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
			aria-hidden="true">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					Proposta inválida. Verifique os dados.
				</div>
			</div>
		</div>

		<div class="modal fade modal-detalhe" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
			aria-hidden="true">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					Ao clicar ir para o detalhe do item, conectar com a API Java que retorna os detalhes do item.
				</div>
			</div>
		</div>

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://code.jquery.com/jquery-1.12.4.min.js"
			integrity="sha384-nvAa0+6Qg9clwYCGGPpDQLVpLNn0fRaROjHqs13t4Ggj3Ez50XnGQqc/r8MhnRDZ"
			crossorigin="anonymous"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed --> crossorigin="anonymous"
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"
			integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd"
			crossorigin="anonymous"></script>

		<!-- jQuery Custom Scroller CDN -->
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

		<!-- JS functions -->
		<script src="js/scripts.js"></script>

		<script type="text/javascript">
			$(document).ready(function () {
				getSession('appBV');
				pagDetalhe();
			});
		</script>
		<!-- Proposta-->
		<!-- Convert to JSON -->
		<script>
			// Serializing the data and converting to json format
			$.fn.serializeObject = function () {
				var o = {};
				var a = this.serializeArray();
				$.each(a, function () {
					if (o[this.name] !== undefined) {
						if (!o[this.name].push) {
							o[this.name] = [o[this.name]];
						}
						o[this.name].push(this.value || '');
					} else {
						o[this.name] = this.value || '';
					}
				});
				return o;
			};

		</script>
		<script>
			function checkData(a) {
				console.log(a);
			}
		</script>

		<script>
			// Sending the data
			function getIdItem() {
				if (sessionStorage.getItem("idItem") !== undefined) {
					idItem = sessionStorage.getItem("idItem");
					console.log("idItem:", idItem)
					document.getElementById("idItem").value = idItem;
					return idItem;
				}
				else {
					return false;
				}
			}
			function sendPropostaJson() {
				console.log("ENVIANDO JSON");
				var idItem = getIdItem();

				if (idItem) {
					var jData = JSON.stringify($('form').serializeObject());
					console.log('JSON', jData);

					// Creating a XHR object
					let xhr = new XMLHttpRequest();
					let url = "http://54.163.66.128:8082/emprestimos/enviarProposta";
					var response = '';

					// open a connection
					xhr.open("POST", url, true);

					// Set the request header i.e. which type of content you are sending
					xhr.setRequestHeader("Content-Type", "application/json");

					// Create a state change callback
					xhr.onreadystatechange = function () {
						if (xhr.readyState === 4 && xhr.status === 200) {



							//Redirect to Publish page
							response = JSON.parse(this.responseText);
							$('.modal-proposta-enviada').modal('show');
							setTimeout(function () { $('.modal-proposta-enviada').modal('hide'); }, 3000);

							console.log('proposta enviada:', response["status"]);

							// sendToPublish(jData, response["status"]);

						}

						else if (xhr.status === 500) {

							$('.modal-proposta-invalido').modal('show');


							console.log('proposta invalida:', response["error"]);
						}
					};

					// Sending data with the request 
					xhr.send(jData);
				}



			}

			function storeUserDataInSession(itemId) {
				// window.sessionStorage.setItem('itemData', itemData);
				console.log("storing itemID",itemId);
				window.sessionStorage.setItem('itemId', itemId);
			}
			function sendToPublish(jData, itemId) {
				console.log('Enviado o  item:', jData["nome"], itemId);
				console.log('id stored in session:', itemId);
				// storeUserDataInSession(jData, itemId);
				storeUserDataInSession(itemId); //saving only the id

				location.replace("Publish.htm");
			};
		</script>
</body>

</html>